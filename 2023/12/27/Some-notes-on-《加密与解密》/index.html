<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mynamepfd.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"remove","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="《加密与解密》is a book written by a couple of  master at kanxue.com that tells you about techniques in the software reverse engineering. I bought this book a few years ago, but I couldn’t understand the con">
<meta property="og:type" content="article">
<meta property="og:title" content="Some notes on 《加密与解密》">
<meta property="og:url" content="https://mynamepfd.github.io/2023/12/27/Some-notes-on-%E3%80%8A%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E3%80%8B/index.html">
<meta property="og:site_name" content="Daniel Du&#39;s diary">
<meta property="og:description" content="《加密与解密》is a book written by a couple of  master at kanxue.com that tells you about techniques in the software reverse engineering. I bought this book a few years ago, but I couldn’t understand the con">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-12-27T05:21:33.000Z">
<meta property="article:modified_time" content="2024-01-05T04:59:10.919Z">
<meta property="article:author" content="Daniel Du">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://mynamepfd.github.io/2023/12/27/Some-notes-on-%E3%80%8A%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E3%80%8B/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Some notes on 《加密与解密》 | Daniel Du's diary</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Daniel Du's diary</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-photos">

    <a href="/photos/" rel="section"><i class="fa fa-image fa-fw"></i>Photos</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/mynamepfd" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mynamepfd.github.io/2023/12/27/Some-notes-on-%E3%80%8A%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Daniel Du">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daniel Du's diary">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Some notes on 《加密与解密》
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-27 13:21:33" itemprop="dateCreated datePublished" datetime="2023-12-27T13:21:33+08:00">2023-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-05 12:59:10" itemprop="dateModified" datetime="2024-01-05T12:59:10+08:00">2024-01-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>《加密与解密》is a book written by a couple of  master at kanxue.com that tells you about techniques in the software reverse engineering. I bought this book a few years ago, but I couldn’t understand the content at the time. After a few years on the shelf, I sold it two years ago. But recently I read this book again because I wanted to decrypt a piece of software.</p>
<p>OK. I only want to talk about Chapter 20, 《虚拟机的设计》. It’s “how to design a virtual machine” in english. To be precise, it teaches you how to design a virtual machine software, like the well known VMProtect, to protect your software. This chapter is not easy to understand because the author omitted many details. So, I’d like to write some notes down.</p>
<span id="more"></span>

<h1 id="Part-1-Generate-a-clean-exe"><a href="#Part-1-Generate-a-clean-exe" class="headerlink" title="Part 1 Generate a clean exe"></a>Part 1 Generate a clean exe</h1><p>OK, at first, let’s generate an exe by Visual Studio 2022 based on the code below.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int main() &#123;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, open this exe with IDA Pro(32bit).<br>We find that the generated assembly code is complex although our program is the simplest!<br>We need a clean exe for subsequent research, but how to do that? I read an article called “How to write your own packer”. In this article, the author listed some options for generating a clean exe, which have all changed in Visual Studio 2022.<br>Well, in Visual Studio 2022, we just need to tweak a few options.<br>First, fill Properties-&gt;Linker-&gt;Advanced-&gt;Entry Point with “main” so that the compiler does not generate redundant code in the entry point.<br>Second, set “Randomized Base Address” to “No”, and “Fixed Base Address” to “Yes”, which helps us to dynamically debug the program in OllyDbg.<br>OK, now, let’s generate the exe again and open it with IDA Pro, we’ll see that the resulting assembly code is very clear!<br>There are also a couple of options that may help you.<br>The fist option is Properties-&gt;Linker-&gt;Optimization-&gt;References. Setting this to “No” will ensure that your function is preserved in the final exe.<br>For example, if we generate an exe base on the following code</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void crack_me() &#123;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When opened with IDA Pro, the function crack_me will not be found because it is not used by any of the code in the main function, so the compiler omits it when generating assembly code. Changing “References” to “No” will force the linker to preserve the function crack_me.<br>The second option is Properties-&gt;C&#x2F;C++-&gt;Code Generation-&gt;Security Check.<br>The third option is “Enable Enhanced Instruction Set”, which is also under Code Generation. Turning this option off will force the compiler to generate simple code instead of code using advanced but more efficient assembly instructions such as xmm. This option is useful because you may be not sure if your disassembly engine understands these advanced instructions, so I encourage you turn this option off.</p>
<h1 id="Part-2-Technical-details-in-the-code"><a href="#Part-2-Technical-details-in-the-code" class="headerlink" title="Part 2 Technical details in the code"></a>Part 2 Technical details in the code</h1><p>The author gives a VMP he wrote for a software reverse engineering competition, although the VMP was written over a decade ago. The disassembly engine used by the VMP is from OllyDbg. So, &#x2F;J should be added as an additional option into Properties-&gt;C&#x2F;C++-&gt;Command Line.<br>The idea of the VMP is to translate assembly instructions of a function that need to be protected (such as crack_me in the code above) into virtual instructions and running those instructions in the virtual machine.<br>The function of the virtual machine is to read virtual instructions one by one in memory and dispatch them to different handlers. So, the virtual machine is actually a set of assembly instructions that can be executed by CPU and the virtual instructions are actually a set of bytes, not assembly instructions.<br>So, the VMP consists of two parts. The first part is the virtual machine. The second part is a program which is able to translate the assembly instructions into virtual instructions and adding the virtual machine and virtual instructions into the final exe.<br>In the VMP, the VCommand contains the assembly instructions of the virtual machine, which is the first part mentioned above, and the InterpretHandler contains the code that can convert assembly instructions to virtual instructions.<br>So what does the VMP actually do?<br>Let’s take a look at the first instruction at the entry point</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push ebp</span><br></pre></td></tr></table></figure>
<p>Due to the instruction will be protected and executed by the virtual machine, so the result of the instruction should be that the vebp is stored on the virtual stack.<br>It will be translted into following virtual instructions</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DPushReg32 vebp_idx</span><br><span class="line">vPush</span><br><span class="line">DPopReg32 vebp_idx</span><br><span class="line">vSaveEsp</span><br></pre></td></tr></table></figure>
<p>There is a context which contains registers like EAX, EBX, and etc, but it is used and maintained by the virtual machine and addressed by EDI. For ease of distinction, we use veax and vebx and etc to refer to these registers. Similarly, there is also a stack used and maintained by the virtual machine and addressed by EBP. Note that the virtual stack is only be used in those situations where the real stack could be used, such as calling a function.<br>And, ESI points to the next byte in the stream of virtual instructions.<br>So, in the code above, vebp_idx is the index of the vesp in the VM context, and DPushReg32 pushes the value of the vebp onto the REAL stack, not the virtual stack! So, after executing the first instruction, the real stack will look like this</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vebp</span><br></pre></td></tr></table></figure>
<p>And ESP points to it.<br>So, what does the vPush do?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.bug:00404632 vPush:                                  ; DATA XREF: .bug:00404030↑o</span><br><span class="line">.bug:00404632                 mov     eax, [esp]</span><br><span class="line">.bug:00404635                 sub     ebp, 4</span><br><span class="line">.bug:0040463B                 mov     [ebp+0], eax</span><br><span class="line">.bug:00404641                 mov     [esp], eax</span><br><span class="line">.bug:00404644                 jmp     DCheckESP</span><br></pre></td></tr></table></figure>
<p>The first instruction indicates that vebp is moved to eax.<br>The second instruction indicates that EBP is shifted up so that deposit a parameter onto the virtual stack.<br>The third instruction indicates that the vebp is deposited onto the virtual stack.<br>Let’s ignore the fourth instruction for now. I’ll discuss it later.<br>The final instruction indicates to some checks are to be performed to prevent the real stack from being so close to the VM context.<br>Well, after executing the first two instructions,  vebp is stored in the virtual stack. That’s what we want!<br>Then the virtual machine will pop the vebp on the real stack into the VM context.<br>The DPushXXX and DPopXXX pairs are used to ensure that the virtual registers are not be changed by the virtual instructions.<br>What does the vSaveEsp do?<br>After executing DPushReg32 and DPopReg32, the real stack is balanced, but what about the virtual stack?<br>We know that the EBP has been subtracted by 4. The vSaveEsp simply sets vesp to EBP to record the new stack top!</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.bug:00404627 vSaveEsp:                      ; DATA XREF: .bug:0040402C↑o</span><br><span class="line">.bug:00404627                 mov     [edi+10h], ebp  </span><br><span class="line">.bug:0040462D                 jmp     DCheckESP</span><br></pre></td></tr></table></figure>


<p>OK. now let’s consider the second instruction</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov ebp,esp</span><br></pre></td></tr></table></figure>
<p>It will be translted into following virtual instructions</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DPushReg32 vesp_idx</span><br><span class="line">DPushReg32 vebp_idx</span><br><span class="line">vMov</span><br><span class="line">DPopReg32 vebp_idx</span><br><span class="line">DFree</span><br></pre></td></tr></table></figure>
<p>After the first two instructions, the real stack looks like</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vebp</span><br><span class="line">vesp</span><br></pre></td></tr></table></figure>
<p>what does the vMov do?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.bug:00404649 vMov:                                   ; DATA XREF: .bug:00404034↑o</span><br><span class="line">.bug:00404649                 mov     eax, [esp]</span><br><span class="line">.bug:0040464C                 mov     ecx, [esp+4]</span><br><span class="line">.bug:00404653                 push    dword ptr [edi+38h]</span><br><span class="line">.bug:00404659                 popf</span><br><span class="line">.bug:0040465A                 mov     eax, ecx</span><br><span class="line">.bug:0040465C                 pushf</span><br><span class="line">.bug:0040465D                 pop     dword ptr [edi+38h]</span><br><span class="line">.bug:00404663                 mov     [esp], eax</span><br><span class="line">.bug:00404666                 mov     [esp+4], ecx</span><br><span class="line">.bug:0040466D                 jmp     DCheckESP</span><br></pre></td></tr></table></figure>
<p>Looking at the code above, it is interesting to note that we can regard eax and ebx as references to parameters. For example, eax is a reference to vebp, and ecx is a reference to vesp, so<br>the fifth instruction ‘mov eax, ecx’ means to set vebp to vesp. Why? Because at the end of this code, the values of eax and ecx are stored back on the real stack, and then the value, which is the new vebp,in the real stack is stored back in the VM context due to the next virtual instruction “DPopReg32 vebp_idx”.<br>DFree simply adds 4 to the ESP to keep the real stack balanced, since the second value in the real stack is useless.</p>
<p>OK. now let’s consider another instruction</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub esp,8</span><br></pre></td></tr></table></figure>
<p>It will be translted into following virtual instructions</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DPushReg32 vesp_idx</span><br><span class="line">DPushImm32 8</span><br><span class="line">vSub</span><br><span class="line">DPopReg32 vesp_idx</span><br><span class="line">DFree</span><br><span class="line">vRestoreEsp</span><br></pre></td></tr></table></figure>
<p>After the first two instructions, the real stack looks like</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">vesp</span><br></pre></td></tr></table></figure>
<p>what does the vSub do?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.bug:00404672 vSub:                                   ; DATA XREF: .bug:00404038↑o</span><br><span class="line">.bug:00404672                 mov     eax, [esp]</span><br><span class="line">.bug:00404675                 mov     ecx, [esp+4]</span><br><span class="line">.bug:0040467C                 push    dword ptr [edi+38h]</span><br><span class="line">.bug:00404682                 popf</span><br><span class="line">.bug:00404683                 sub     eax, ecx</span><br><span class="line">.bug:00404685                 pushf</span><br><span class="line">.bug:00404686                 pop     dword ptr [edi+38h]</span><br><span class="line">.bug:0040468C                 mov     [esp], eax</span><br><span class="line">.bug:0040468F                 mov     [esp+4], ecx</span><br><span class="line">.bug:00404696                 jmp     DCheckESP</span><br></pre></td></tr></table></figure>
<p>Well, it means that vesp is subtracted by 4. But vesp represents the top of the virtual stack, and now EBP is clearly not equal to vesp, so use vRestoreEsp to set EBP to vesp.</p>
<p>OK. That’s all the confusion I encountered while reading the source code. I’m sure you can write clearer code after understanding how the VMP works. I’d like to do this, but I don’t have the time at the moment. By the way, the author has made some modifications to OllyDbg’s disassembly engine to get the extra information needed by the VMP. I discovered that udis86 can do this as well. Anyway, even though the code for VMP is not very good, the author should be thanked.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/2023/12/28/Programming-and-Life/" rel="next" title="Programming and Life">
      Programming and Life <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daniel Du</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
